<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>äº”ä¸€åå‘æ—…æ¸¸æ•°æ®å¯è§†åŒ–</title>
  <style>
    body { font-family: 'PingFang SC', 'Microsoft YaHei', Arial, sans-serif; margin: 0; background: #fafafa;}
    .banner { text-align: center; padding: 20px 0 0 0; background: #e0f7fa;}
    .slogan { color: #26a69a; font-size: 1.2em; }
    .keywords { margin: 12px 0;}
    .keyword { background: #80deea; color: #005662; border-radius: 12px; padding: 3px 14px; margin: 0 3px; font-size: 0.95em;}
    .map-section { max-width: 1000px; margin: 32px auto 0 auto; padding: 0 20px;}
    .map-container { width: 100%; height: 520px; border-radius: 14px; box-shadow: 0 2px 12px #90caf9; background: #fff;}
    .tab-bar { margin: 20px 0 6px 0; text-align: center;}
    .tab { background: #fff; border: 1px solid #b2ebf2; border-radius: 14px; padding: 8px 18px; margin: 0 7px; font-size: 1em; color: #0097a7; cursor: pointer;}
    .tab.active { background: #00bcd4; color: #fff;}
    .timeline { text-align: center; margin: 16px 0;}
    .footer { text-align: center; color: #607d8b; padding: 28px 0 20px 0;}
    .easter-egg { margin: 8px 0;}
    .card-popup { position: absolute; min-width: 140px; background: #fff; border-radius: 14px; box-shadow: 0 2px 8px #80cbc4; border: 1px solid #b2ebf2; padding: 18px; z-index: 100; }
  </style>
  <!-- å¼•å…¥ ECharts ä¸»åº“ -->
  <script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
</head>
<body>
  <header class="banner">
    <h1>äº”ä¸€åå‘æ—…æ¸¸æ•°æ®å¯è§†åŒ–</h1>
    <p class="slogan">ç”¨ä¸€å¼ ä¸»è§†è§‰åœ°å›¾+å¤šç»´äº¤äº’åˆ†å±‚ï¼Œæ²‰æµ¸å¼è®²è¿°â€˜åå‘æ—…æ¸¸â€™å’Œäº”ä¸€æ–°ç”Ÿæ´»æ–¹å¼è¶‹åŠ¿</p>
    <div class="keywords">
      <span class="keyword">ä¸‹æ²‰åŸå¸‚</span>
      <span class="keyword">åå‘æ—…æ¸¸çƒ­</span>
      <span class="keyword">Citywalk</span>
      <span class="keyword">OOTD</span>
    </div>
  </header>
  <main>
    <section class="map-section">
      <div id="mainMap" class="map-container"></div>
      <div class="tab-bar">
        <button class="tab active" data-tab="heat">çƒ­åŠ›è¶‹åŠ¿</button>
        <button class="tab" data-tab="trend">æ—…è¡Œæ–¹å¼è¶‹åŠ¿</button>
        <button class="tab" data-tab="consume">æ¶ˆè´¹ç»“æ„</button>
        <button class="tab" data-tab="emotion">èˆ†è®ºçƒ­è¯</button>
        <button class="tab" data-tab="fashion">ç©¿æ­æ½®æµ</button>
      </div>
      <div class="timeline">
        <input type="range" min="0" max="4" value="0" id="timelineSlider">
        <span id="timelineLabel">å‡æœŸç¬¬1å¤©</span>
      </div>
    </section>
  </main>
  <footer class="footer">
    <div class="summary">æ•°æ®å¯è§ï¼Œä½“éªŒåˆ›æ–°ã€‚å›¢é˜Ÿï¼šåˆ›æ–°å¯è§†åŒ–å°ç»„</div>
    <div class="easter-egg">ğŸ <a href="#" id="easterEgg">ç‚¹æˆ‘ç”Ÿæˆä½ çš„äº”ä¸€æ½®æµæ ‡ç­¾ï¼</a></div>
  </footer>

  <script>
    // 1. æ‹‰å–å…¨å›½ GeoJSONï¼Œå¤šè¾¹å½¢ Feature æ•°é‡åº”è¿œå¤§äº1
    fetch('https://geojson.cn/api/china/100000.json')
      .then(res => res.json())
      .then(geoJson => {
        console.log('åŠ è½½åˆ°çš„ feature æ•°é‡ï¼š', geoJson.features.length);
        echarts.registerMap('china', geoJson);

        // 2. åˆå§‹åŒ– ECharts
        const tabOptions = {
          heat: { /* â€¦ä¿æŒä½ ä¹‹å‰çš„ heat æ•°æ®â€¦*/ },
          trend: { /* â€¦*/ },
          consume: { /* â€¦*/ },
          emotion: { /* â€¦*/ },
          fashion: { /* â€¦*/ }
        };

        var chart = echarts.init(document.getElementById('mainMap'));
        var baseOption = {
          tooltip: { show: true, trigger: 'item', formatter: p => {
            return `${p.name}<br>å€¼ï¼š${p.value[2]||p.value}`;
          }},
          geo: {
            map: 'china',
            roam: true,
            zoom: 1.18,
            itemStyle: {
              normal: { areaColor: '#e0f7fa', borderColor: '#b2ebf2' },
              emphasis: { areaColor: '#80deea' }
            },
            label: { show: false }
          },
          series: []
        };

        let currentTab = 'heat';
        chart.setOption(Object.assign({}, baseOption, tabOptions[currentTab]));

        // Tab åˆ‡æ¢
        document.querySelectorAll('.tab').forEach(tab => {
          tab.addEventListener('click', function() {
            document.querySelector('.tab.active').classList.remove('active');
            this.classList.add('active');
            currentTab = this.getAttribute('data-tab');
            chart.setOption(Object.assign({}, baseOption, tabOptions[currentTab]), true);
          });
        });

        // æ—¶é—´è½´
        document.getElementById('timelineSlider').addEventListener('input', function() {
          document.getElementById('timelineLabel').innerText = 'å‡æœŸç¬¬' + ( +this.value + 1 ) + 'å¤©';
        });

        // ç‚¹å‡»å¼¹çª—
        chart.on('click', params => {
          const old = document.querySelector('.card-popup');
          if (old) old.remove();
          if (!params.name) return;
          const popup = document.createElement('div');
          popup.className = 'card-popup';
          popup.innerHTML = `
            <strong>${params.name}</strong><br>
            çƒ­åº¦ï¼š${(params.value[2]||params.value)}<br>
            ç‚¹å‡»æŸ¥çœ‹æ›´å¤šâ€¦
          `;
          const rect = chart.getDom().getBoundingClientRect();
          let x = params.event.offsetX, y = params.event.offsetY;
          if (x > rect.width - 200) x = rect.width - 200;
          if (y > rect.height - 120) y = rect.height - 120;
          popup.style.left = x + 'px';
          popup.style.top  = y + 'px';
          document.getElementById('mainMap').appendChild(popup);
          setTimeout(()=>{
            document.addEventListener('click', function h(e){
              if (!popup.contains(e.target)) {
                popup.remove();
                document.removeEventListener('click', h);
              }
            });
          },10);
        });

        // çª—å£è‡ªé€‚åº”
        window.addEventListener('resize', () => chart.resize());
      })
      .catch(err => console.error('åœ°å›¾åŠ è½½æˆ–è§£æå‡ºé”™ï¼š', err));
  </script>

</body>
</html>
